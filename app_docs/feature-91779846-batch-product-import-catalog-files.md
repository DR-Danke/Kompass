# Batch Product Import from Supplier Catalog Files

**ADW ID:** 91779846
**Date:** 2026-02-12
**Specification:** specs/issue-123-adw-91779846-sdlc_planner-batch-product-import-catalog-files.md

## Overview

A batch import script that processes all 52 supplier catalog files (Excel and PDF) from the `PROVEEDORES - CATALOGOS` directory, extracts product data using the extraction service, maps each file to the correct supplier and category via `seed_mappings.json`, and imports products into the database. The script includes CLI flags for `--dry-run`, `--file`, and `--verbose` modes, handles duplicate SKUs gracefully, and outputs a summary table with detailed JSON results.

## What Was Built

- Batch import script (`apps/Server/scripts/import_products.py`) with a hardcoded `FILE_MAP` of 47 catalog files mapped to their supplier and category
- Extraction pipeline that routes `.xlsx`/`.xls` files to `process_excel()` and `.pdf` files to `process_pdf()`
- DTO conversion layer mapping `ExtractedProduct` fields to `ProductCreateDTO` fields
- CLI interface with `--dry-run`, `--file`, and `--verbose` flags
- Formatted summary table output and JSON results file (`scripts/output/import_results.json`)
- Duplicate SKU detection and graceful error handling

## Technical Implementation

### Files Modified

- `apps/Server/scripts/import_products.py`: New 690-line batch import script (main deliverable)

### Key Changes

- **FILE_MAP dictionary**: Hardcoded mapping of 47 catalog files to their supplier name and category path, organized by category folder (BAÑOS, DECK, ILUMINACION, MOBILIARIO, PISOS, REVESTIMIENTOS, etc.). Five non-product files are excluded (directories, templates, RFQs).
- **Seed mappings integration**: Loads `seed_mappings.json` at startup to resolve supplier names and category paths to UUIDs. Validates that mappings contain both suppliers and categories before proceeding.
- **ExtractedProduct to ProductCreateDTO conversion**: Maps `price_fob_usd` → `unit_cost`, `moq` → `minimum_order_qty`, appends `material` to description, sets `status = "draft"`, defaults `origin_country = "China"`, and defaults `unit_of_measure = "piece"`.
- **Error classification**: Bulk import errors are classified as duplicates (containing "duplicate" or "unique" in the error message) vs. other errors, with separate counters for each.
- **Output**: Prints a formatted summary table with per-file and total counts, and writes detailed `import_results.json` with timestamps, supplier/category info, and error details.

### FILE_MAP Coverage

| Category | Files | Suppliers |
|----------|-------|-----------|
| BAÑOS | 8 | HUAYI, JVK, LAYASDUN, PINLSLON, CONRAZZO, BATH STORE-TAUSU |
| DECK - FACHADAS | 2 | MEXY TECH |
| DISPENSADORES | 1 | LAYASDUN |
| DOTACION DE COCINA | 3 | WIREKING, MAYORISTA COLOMBIA |
| ESPEJOS | 2 | LUXDREAM |
| ILUMINACION | 5 | GEORGE, BWBYONE |
| MOBILIARIO | 8 | LEIZI, NTFT YIFUYUAN, FOSHAN SHISUO, DHF, WEIRE, SENCHUAN |
| ONE STOP SHOP | 5 | GEORGE, PA HOME |
| PISOS - GUARDAESCOBAS | 9 | CU MATERIALS, HONGYU, JINGDA, SOTENG |
| REVESTIMIENTOS | 3 | CU MATERIALS, WUXI KAIZE |
| TARIMAS & EVENTOS | 1 | VAN-RUBEN |

## How to Use

1. Ensure seed data has been populated first by running `python -m scripts.seed_all` (creates `scripts/output/seed_mappings.json`)
2. Navigate to the Server directory: `cd apps/Server`
3. Run the full import:
   ```bash
   python -m scripts.import_products
   ```
4. For a dry-run (parse only, no database writes):
   ```bash
   python -m scripts.import_products --dry-run
   ```
5. To process a single file:
   ```bash
   python -m scripts.import_products --file "BAÑOS/GRIFERIASS/HUAYI/HUAYI (1).xlsx"
   ```
6. For verbose output showing each product:
   ```bash
   python -m scripts.import_products --verbose --dry-run
   ```
7. Review results in `apps/Server/scripts/output/import_results.json`

## Configuration

- **Seed mappings file**: `apps/Server/scripts/output/seed_mappings.json` (auto-generated by seed scripts)
- **Catalog base path**: `Requirements_Gathering/Sourcing/Data/PROVEEDORES - CATALOGOS/` (relative to repo root)
- **Output file**: `apps/Server/scripts/output/import_results.json` (git-ignored)

## Testing

- Run `--dry-run` mode to validate parsing without database writes
- Run `--file` with a specific file to test single-file processing
- Run `--verbose` to inspect individual product mappings
- Lint: `cd apps/Server && .venv/bin/ruff check scripts/import_products.py`
- Backend tests: `cd apps/Server && .venv/bin/pytest tests/ -v --tb=short`

## Notes

- The script is idempotent: re-running skips duplicates without crashing (duplicate SKUs are counted separately)
- Files are processed sequentially to avoid database connection pool exhaustion
- All products default to `origin_country = "China"` and `status = "draft"`
- `CU MATERIALS/Precios CU Materiales seleccionados.xlsx` appears in both PISOS and REVESTIMIENTOS with different category assignments; duplicate SKUs from the second import are expected
- `.xls` files (older Excel format) may require the `xlrd` library
- Chinese character filenames (e.g., `【PS线条目录+颜色】`) are supported natively by Python
- This is a one-off data migration script, not part of the application server runtime
